<Window x:Class="AIMD.ReportApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AIMD.ReportApp"
        mc:Ignorable="d"
        Title="AIMDiagnostic Report Builder"
        Height="720"
        Width="1180"
        MinWidth="900"
        MinHeight="640">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="Enter" Modifiers="Control" Command="{Binding GenerateCommand}" />
        <KeyBinding Key="R" Modifiers="Control+Alt" Command="{Binding RegenerateCommand}" />
        <KeyBinding Key="P" Modifiers="Control+Alt" Command="{Binding PasteCommand}" />
        <KeyBinding Key="Escape" Command="{Binding ClearCommand}" />
        <KeyBinding Key="I" Modifiers="Control+Alt" Command="{x:Static local:MainWindow.FocusIndicationCommand}" />
        <KeyBinding Key="C" Modifiers="Control+Alt" Command="{x:Static local:MainWindow.FocusComparisonCommand}" />
        <KeyBinding Key="D" Modifiers="Control+Alt" Command="{x:Static local:MainWindow.FocusDictationCommand}" />
    </Window.InputBindings>

    <Window.CommandBindings>
        <CommandBinding Command="{x:Static local:MainWindow.FocusIndicationCommand}" Executed="HandleFocusIndication" />
        <CommandBinding Command="{x:Static local:MainWindow.FocusComparisonCommand}" Executed="HandleFocusComparison" />
        <CommandBinding Command="{x:Static local:MainWindow.FocusDictationCommand}" Executed="HandleFocusDictation" />
    </Window.CommandBindings>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0"
                Margin="0,0,12,12"
                Padding="12"
                Background="#F8F9FA"
                BorderBrush="#D0D4DA"
                BorderThickness="1"
                CornerRadius="8">
            <StackPanel>
                <TextBlock Text="Exam"
                           FontWeight="Bold"
                           FontSize="14" />
                <ComboBox ItemsSource="{Binding ExamOptions}"
                          SelectedItem="{Binding SelectedExam}"
                          Margin="0,4,0,12"
                          Height="28" />

                <TextBlock Text="Indication (Ctrl+Alt+I)"
                           FontWeight="SemiBold" />
                <TextBox x:Name="IndicationInput"
                         Text="{Binding Indication, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         Height="60"
                         Margin="0,4,0,12" />

                <TextBlock Text="Comparison (Ctrl+Alt+C)"
                           FontWeight="SemiBold" />
                <TextBox x:Name="ComparisonInput"
                         Text="{Binding Comparison, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         Height="60"
                         Margin="0,4,0,12" />

                <TextBlock Text="Dictation (Ctrl+Enter to generate)"
                           FontWeight="SemiBold" />
                <TextBox x:Name="DictationInput"
                         Text="{Binding Dictation, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         Height="220"
                         Margin="0,4,0,16" />

                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Left"
                            Margin="0,8,0,0">
                    <Button Content="Generate"
                            Width="100"
                            Margin="0,0,8,0"
                            Command="{Binding GenerateCommand}" />
                    <Button Content="Regenerate"
                            Width="110"
                            Margin="0,0,8,0"
                            Command="{Binding RegenerateCommand}" />
                    <Button Content="Clear"
                            Width="80"
                            Margin="0,0,8,0"
                            Command="{Binding ClearCommand}" />
                    <Button Content="Copy to PowerScribe"
                            Width="170"
                            Command="{Binding PasteCommand}" />
                </StackPanel>
            </StackPanel>
        </Border>

        <TabControl Grid.Column="1"
                    Grid.Row="0"
                    Margin="0,0,0,12">
            <TabItem Header="Findings">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Findings}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#E0E3E8"
                                        BorderThickness="0,0,0,1"
                                        Padding="0,12,0,12">
                                    <StackPanel>
                                        <DockPanel>
                                            <TextBlock Text="{Binding Name}"
                                                       FontWeight="Bold"
                                                       DockPanel.Dock="Left" />
                                            <TextBlock Text="Edited"
                                                       Foreground="#D97706"
                                                       FontSize="11"
                                                       Margin="8,0,0,0"
                                                       VerticalAlignment="Center"
                                                       Visibility="{Binding IsUserEdited, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                        </DockPanel>
                                        <TextBox Text="{Binding Content, UpdateSourceTrigger=PropertyChanged}"
                                                 TextWrapping="Wrap"
                                                 AcceptsReturn="True"
                                                 VerticalScrollBarVisibility="Auto"
                                                 MinHeight="80"
                                                 ToolTip="{Binding LastEngineSuggestion}" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>
            <TabItem Header="Impression">
                <Grid Margin="12">
                    <TextBox Text="{Binding ImpressionText, UpdateSourceTrigger=PropertyChanged}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto" />
                </Grid>
            </TabItem>
            <TabItem Header="Unmapped">
                <Grid Margin="12">
                    <TextBox Text="{Binding UnmatchedJson}"
                             IsReadOnly="True"
                             FontFamily="Consolas"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto" />
                </Grid>
            </TabItem>
        </TabControl>

        <StatusBar Grid.Row="1"
                   Grid.ColumnSpan="2">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
